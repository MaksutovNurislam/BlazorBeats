@inject NavigationManager Nav
@inject UserSession Session
@inject BeatService BeatService
@inject BlazorBeats.Services.ProfileService ProfileService
@inherits LayoutComponentBase


<style>
    .topbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: #222;
        color: white;
        padding: 1rem;
        flex-wrap: wrap;
    }

        .topbar .user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

            .topbar .user-info img {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                object-fit: cover;
            }

    .nav-links {
        list-style: none;
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin: 0;
        padding: 0;
    }

        .nav-links li {
            margin: 0;
        }

        .nav-links a,
        .nav-links button {
            color: white;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            text-decoration: none;
            padding: 0.5rem 1rem;
        }

            .nav-links a:hover,
            .nav-links button:hover {
                color: #00aced;
            }

    .nav-btn {
        background-color: #00aced;
        color: white;
        border: none;
        border-radius: 6px;
        padding: 0.5rem 1rem;
        font-size: 1rem;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

        .nav-btn:hover {
            background-color: #0084b4;
        }

    .logout-btn {
        background-color: #ff5c5c;
    }

        .logout-btn:hover {
            background-color: #e04646;
        }

</style>

<div class="topbar">
    @if (UserProfile != null)
    {
        <div class="user-info">
            <img src="@UserProfile.AvatarUrl" alt="Аватар" />
            <div>
                <div>@UserProfile.Name</div>
                <div style="font-size: 0.9rem;">Баланс: $@UserProfile.Balance.ToString("0.00")</div>
            </div>
        </div>
    }

    <ul class="nav-links">
        <li><button class="nav-btn" @onclick="@(() => Nav.NavigateTo("/dashboardadmin"))">Главная</button></li>
        <li><button class="nav-btn" @onclick="@(() => Nav.NavigateTo("/upload-beat"))">Каталог битов</button></li>
        <li><button class="nav-btn" @onclick="@(() => Nav.NavigateTo("/testpage"))">Лицензии</button></li>
        <li><button class="nav-btn" @onclick="@(() => Nav.NavigateTo("/profile"))">Мой профиль</button></li>
        <li><button class="nav-btn" @onclick="@(() => Nav.NavigateTo("/my-purchases"))">Мои покупки</button></li>
        <li><button class="nav-btn" @onclick="@(() => Nav.NavigateTo("/my-sales"))">Мои продажи</button></li>
        <li><button class="nav-btn" @onclick="@(() => Nav.NavigateTo("/moderation"))">Модерация контента</button></li>
        <li><button class="nav-btn" @onclick="@(() => Nav.NavigateTo("/reports"))">Отчёты</button></li>
        <li><button class="nav-btn logout-btn" @onclick="Logout">Выйти</button></li>
    </ul>
</div>

<div class="content">
    @Body
</div>

@code {
    private Profile? UserProfile;

    protected override async Task OnInitializedAsync()
    {
        if (Session.CurrentUser != null)
        {
            UserProfile = await ProfileService.GetProfileByUserIdAsync(Session.CurrentUser.Id);
        }
    }

    private void Logout()
    {
        Session.Logout();
        Nav.NavigateTo("/login");
    }
}
